\part{Contexte}
\chapter{L'entreprise}
\section{Alter Way}
\index{Alter Way}
\paragraph*{}
	Alter Way est une entreprise spécialisée dans les services informatiques utilisant des logiciels \emph{open source}
	\footnote{Un logiciel \emph{open source}\index{\emph{open source}} est un logiciel dont le code source est librement accessible et modifiable par tout le monde.}.
	Elle est composée de cinq groupes afin de répondre à l'ensemble des besoins des SI\footnote{Système d'Information}:
	\begin{description}
		\item[Hosting] Hébergement et infogérance système de site web
		\item[Solution] Développement, maintenance et infogérance applicatif de site web
		\item[Formation] Formation standard, cursus de formation, coatching
		\item[Consulting] Conseil, audit, industrialisation
		\item[Creative] Conseil en communication, infographisme
	\end{description}

	\begin{figure}
	\centering
	\includegraphics[width=0.9\textwidth]{resource/img/aw_360}
	\caption{Les différentes branches d'Alter Way}
	\end{figure}

\section{Histoire}
\paragraph*{}
	Créée en 2006, Alter Way est la première entreprise française à avoir fédéré les acteurs historiques
	de l'\emph{open source} autour d'un projet d'industrialisation du marché:

	\begin{description}
		\item[Anaska] Leader français de formation \emph{open source} en 2001
		\item[Eclip's Software] Éditeur d'une solution d'administration réseau
		\item[Ingeniweb] Spécialiste en solution web d'entreprise de gestion de contenu
		\item[Kanopee] Consultants en développement PHP
		\item[Nexen Services] Hébergement et Infogérance LAMP\footnote{Linux Apache MySQL PHP}
		\item[O4DB] Expertise en BDD\footnote{Base de Donnée}
		\item[Solinux] Spécialistes dans l'administration de plateforme Linux et l'intégration d'OpenXchange
	\end{description}

	Afin de renforcer son offre globale et de soutenir sa stratégie de développement sur le web, Alter Way
	a également intégré l'agence de communication \emph{Reciprok}, spécialiste de conseil en communication,
	studio graphique et web-marketing.

	\begin{figure}
		\centering
		\includegraphics[width=0.9\textwidth]{resource/img/historique_aw}
		\caption{L'histoire d'Alter Way}
	\end{figure}

\section{Quelques chiffres (2010)}
 \begin{listi}
		\item 10M\euro{} de Chiffre d'affaire
		\item 10\% de croissance
		\item Résultats: +4.5\%
		\item 120 collaborateurs
 \end{listi}

\section{Alter Way Hosting}
\paragraph*{}
Alter Way Hosting (AWH), anciennement Nexen Services est la branche de la société dont le rôle est l'hébergement et l'infogérance de services internet.
Les services hébergés sont pour la plupart des sites web ainsi que des serveurs de messagerie.

\paragraph*{}
AWH est organisé en quatre équipes affectées à quatre types d'offres différentes:

\begin{description}
	\item[L'équipe responsables des serveurs dédiés vserveurs \index{VServer}\footnotemark]
		\footnotetext{Technologie de virtualisation de système d'exploitation permettant d'héberger plusieurs clients sur un seul serveur}
	\item[L'équipe responsable des offres mutualisées
		\footnotemark] \footnotetext{Plusieurs sites internet sont hébergés sur un même serveur par un seul logiciel de serveur web}
	\item[Les RTC \index{RTC}\footnotemark des architectures] \footnotetext{RTC: Responsable Chef de Compte, similaire à Chef de Projet}
		gèrent les clients les plus importants possédant plusieurs serveurs dédiés
	\item[Les responsables de l'infrastructure] s'occupent des tâches plus globales touchant à tous les serveurs,
		principalement la gestion du réseau.

\end{description}


\section{Hiérarchie}

\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{resource/graph/hier}
	\caption{Un extrait de la hiérarchie d'Alter Way}
\end{figure}

\chapter{Sujet du stage}


\section{La virtualisation}
\label{virtualisation}
\index{Virtualisation}
\paragraph*{}
La virtualisation consiste à faire fonctionner un logiciel ou un système d'exploitation (SE) dans un environnement simulé/virtuel.
\\
Normalement un logiciel est exécuté par le processeur (CPU) de l'ordinateur. Dans le cas de la virtualisation au niveau logiciel,
ce logiciel ne sera pas exécuté directement par un vrai CPU mais par un autre logiciel appelé ``gestionnaire de machine virtuelle''.
\\
Dans le cas de la virtualisation d'un OS (appelé virtualisation matérielle, plusieurs solutions sont possibles. La solution la plus basique est de simuler l'intégralité
de l'ordinateur: le CPU, le disque dur, la carte réseau, l'écran, la souris, le clavier ...
Il devient alors possible de faire fonctionner un OS ou plusieurs OS dans un autre OS.

\subsection{La virtualisation de système d'exploitation}
\label{virtualisation_mat}
\subsubsection{Les différentes techniques}
\paragraph*{}
Il existe plusieurs méthodes pour virtualiser un système d'exploitation. Chacune d'elles ont des avantages et des
inconvénients. Le choix d'une méthode est un compromis entre les performances, l'isolation des systèmes virtualisés
et la simplicité de mise en oeuvre.

\paragraph*{}
Dans ce document, nous appellerons les systèmes d'exploitation virtualisés/invités \textbf{VM} comme \emph{Virtual Machine}\index{Machine Virtuelle (VM)} ou \textbf{domU}\index{domU} suivant le contexte.
Le système d'exploitation principal/hôte sera appelé \textbf{dom0}\index{dom0} ou \textbf{hyperviseur} si aucun autre logiciel n'a déjà ce rôle dans l'architecture de virtualisation
utilisée.

\paragraph*{}
\begin{description}

	\item[Par émulation] Fig \index{Émulation matérielle}\ref{emulation} : Relativement facile à mettre en oeuvre, compatible avec tous les systèmes d'exploitation et toutes les architectures
	de processeur.\\
	L'isolation des VMs est parfaite mais les performances sont extrêmement mauvaises.

	\item[Par isolation] Fig \ref{isolation} : Moyennement facile à mettre en oeuvre, oblige à avoir exactement le même système d'exploitation dans le domU et le dom0.\\
	L'isolation des VMs est généralement très faible mais les performances sont maximales. Les VMs se partagent de manière optimale les ressources de la machine.

	\item[Par noyau en espace utilisateur] Fig \ref{userkernel} : Moyennement facile à mettre en oeuvre et ne fonctionne qu'avec le système d'exploitation Linux en domU.\\
	L'isolation des VMs est très bonne mais les performances plutôt mauvaises.

	\item[Par hyperviseur] Fig \index{Hyperviseur}\ref{hypervisor} : Un peu complexe à mettre en oeuvre mais est capable d'avoir de très bonnes performances si le système d'exploitation invité
	utilise des pilotes spéciaux (appelés pilotes paravirtualisés) pour fonctionner de manière optimisée avec l'hyperviseur.\\
	L'isolation est aussi bonne que la méthode par émulation. Si l'OS invité ne contient pas les bons pilotes, la VM marchera tout de même mais
	avec des performances dégradées.

\end{description}

\begin{figure}[H]
\centering
\subfloat[Par émulation]{\label{emulation}\includegraphics[width=0.4\textwidth]{resource/img/Diagramme_ArchiEmulateur}}
\subfloat[Par isolation]{\label{isolation}\includegraphics[width=0.4\textwidth]{resource/img/Diagramme_ArchiIsolateur}}
\\
\subfloat[Par noyau en espace utilisateur]{\label{userkernel}\includegraphics[width=0.4\textwidth]{resource/img/Diagramme_ArchiKernelUserSpace}}
\subfloat[Par hyperviseur]{\label{hypervisor}\includegraphics[width=0.4\textwidth]{resource/img/Diagramme_ArchiHyperviseur}}
\caption{Les différentes architectures de virtualisation d'OS}
\end{figure}


\section{Le cloud computing\index{Cloud Computing}}
\label{cloud}
\subsection{Principe général}
\paragraph*{}
Le \emph{cloud computing} \footnote{Litéralement: ``informatique dans les nuages''} est une expression
très à la mode ces dernières années et possède une définition très large.
Le principe général est d'externaliser sur des serveurs distants des données ou
des traitements informatiques.

\paragraph*{}
L'avantage pour l'utilisateur du service est qu'il n'a plus à se soucier d'où se situent physiquement
ses données ni de l'administration des serveurs. Toutes les contraintes de sécurité, de disponibilité
et de fiabilité sont déportées à la responsabilité de l'hébergeur.

\paragraph*{}
Pour l'hébergeur, les avantages sont aussi certains: Le cloud computing permet de mutualiser au maximum
les infrastructures matérielles et d'industrialiser une grande partie des processus d'administration.
Par conséquent cette technique permet de diminuer sensiblement les coûts et/ou d'augmenter la qualité
de service.

\subsection{Les différents types de Cloud}

\subsubsection{SaaS: Software as a Service\index{SaaS}}
\paragraph*{}
Le principe du Saas consiste le plus souvent à fournir un service sous la forme d'une application web.
Le type de service rendu est traditionnellement celui que pourrait fournir une application classique.
\\
L'exemple le plus populaire est le webmail\footnote{Interface client de gestion de mail sous forme d'un site web}, comme GMail de Google.

\paragraph*{}
La maintenance des serveurs, de leurs systèmes d'exploitation et des logiciels est faite par le fournisseur de service.
Pour le client, la maintenance ainsi que les MAJ\footnote{MAJ: Mise à jour} des logiciels est transparente et invisible.
\\
Par exemple, personne ne connait le numéro de version de GMail et ça n'intéresse personne.

\subsubsection{PaaS: Platform as a Service\index{PaaS}}
\paragraph*{}
Le PaaS est similaire au Saas à la différence que la gestion du logiciel métier est assurée par le client.
Le fournisseur fournit les serveurs et s'occupe de la bonne configuration du système d'exploitation et des \emph{middlewares}
\footnote{\emph{Middlewares}: Logiciel n'étant pas utilisé directement par le client mais par le logiciel métier ou d'autres \emph{middlewares}} afin
que le logiciel du client fonctionne convenablement.

\paragraph*{}
Alter Way Hosting, est un bon exemple de fournisseur de PaaS: \\
\begin{listi}
\item 	Le client développe et maintient son site web puis le fournit à AWH.\\
\item 	AWH s'occupe d'acheter, de configurer et de brancher en \emph{Data Center}\index{Data Center}\footnote{un Data Center, souvent abbrégé en DC, est une salle
		ou un batiment spécialisé pour y brancher des serveurs. Voir figure \ref{datacenter}} les serveurs puis d'installer et configurer l'OS et les \emph{middlewares} pour que
		le site web du client fonctionne correctement.
\end{listi}

\subsubsection{IaaS: Infrastructure as a Service\index{IaaS}}
\paragraph*{}
Dans le cas de l'IaaS, le fournisseur de service, ne s'occupe plus que de fournir du matériel au client: serveurs, stockage, réseau...
\\
Ce type d'offre est le plus souvent mise en place gràce à la virtualisation (voir chapitre \ref{virtualisation}) de système d'exploitation.
\\
L'entreprise Amazon, fût pionnière dans le domaine de l'IaaS grâce à leur offre d'\textsl{Elastic Compute Cloud}: EC2.

\subsection*{} %To get correct spacement

\begin{figure}[H]
\centering
\includegraphics[width=0.9\textwidth]{resource/img/clouds-users}
\caption{Les différents utilisateurs du Cloud}
\end{figure}

\begin{figure}[H]
\centering
\includegraphics[width=0.9\textwidth]{resource/img/clouds-responsabilities}
\caption{Les différentes responsabilitées des acteurs du Cloud}
\end{figure}

\section{La problématique d'AWH}

\paragraph*{}
Toute cette partie décrit les étapes qui ont été réalisées en amont de mon arrivée dans l'entreprise.

\subsection{État actuel}
\paragraph*{}
Lorsqu'un client fait une demande de serveur, l'équipe doit:
\begin{listi}
	\item Prendre un serveur dans le stock ou en commander un.
	\item Le personnaliser en fonction des besoins du client: Ajouter de la RAM, des disques, des processeurs ...
	\item Installer l'OS Debian\footnote{Debian est un système d'exploitation basé sur Linux} dessus et le configurer.
	\item Emmener et ``racker''\footnote{Terme que l'on utilise pour désigner l'installation d'une lame de serveur dans un rack (baie informatique).\\
		Voir l'annexe \ref{rack}} le serveur
	dans le bon Data Center (DC).
	\item Configurer les équipements réseaux et vérifier que tout fonctionne bien.
\end{listi}

Ce processus est long, laborieux et n'est pas très flexible. Il n'est pas possible sans intervention physique sur la machine d'augmenter ou diminuer sa puissance.

\subsection{Cahier des charges}
\paragraph*{}
L'objectif d'Alter Way Hosting est d'industrialiser/automatiser le processus de déploiement et de mise à jour des serveurs.

\paragraph*{}
Depuis quelques années, l'industrie de l'hébergement informatique est en train de migrer vers une structure de type Cloud utilisant la virtualisation.
Cela permet de faire abstraction des problématiques matérielles. Il devient possible de créer, détruire et même redimensionner des machines virtuelles en
quelques secondes via une simple interface de commande.

\subsubsection{Acteurs du projet}

\paragraph*{}
Dans un premier temps, la nouvelle plateforme ne servira pas directement aux clients mais seulement aux techniciens  qui s'occupent de leurs demandes.\\
Les responsables clients sont des habitués de la ligne de commande et pourront se contenter d'une interface de contrôle simple. Par la suite
il faudrait que les clients ou les commerciaux puissent directement commander et régler en ligne leur commande via une interface web par exemple.

\subsubsection{Fonctionnalités désirées}

\begin{listi}
	\item Créer et supprimer des VMs sans se soucier de l'endroit exact ou elles seront réellement exécutées (principe de base Cloud).
	\item Redimmensionner une VM à chaud (en cours de fonctionnement).\\
		Les propriétés que l'on souhaite pouvoir modifier:
		\subitem Quantité de mémoire vive (RAM)
		\subitem Nombre processeurs virtuels\index{VCPU}\footnote{Les processeurs virtuels (VCPU, \emph{Virtual Central Processing Unit}) sont les processeurs qui apparaissent
			pour la VM. Ils ne correspondent pas forcément à un processeur physique, d'où leur nom.}
		\subitem Taille des disques
		\subitem Nombre de disque
	\item Éffectuer des \index{\emph{Live Migration}}\emph{live migrations}. C'est à dire déplacer une VM d'un hyperviseur à un autre sans interruption de service.\\
		Ceci permet par exemple de décharger un hyperviseur en déplaçant toutes ses VMs sur les autres hyperviseurs ou un hyperviseur de \emph{spare}
		\footnote{un équipement de \index{Spare}\emph{spare} est un équipement (serveur, disque dur ...) qui est laissé éteint mais prêt à être utilisé rapidement
		en cas de problème pour prendre le relais d'un équipement similaire.} pour effectuer une opération de maintenance par exemple.
		\\
		Voir figure \ref{livemigration}.
	\item Dissocier l'hébergement de la VM du stockage de la VM.\\
		Chaque VM a au moins un disque virtuel pour stocker son OS et ses données. L'objectif est d'utiliser un serveur spécialisé dans le stockage de données
		(par exemple une baie de stockage Netapp, voir figure \ref{netapp}) indépendant de la machine faisant tourner les VMs. C'est grâce à cette architecture que
		la \emph{live migration} devient possible.
\end{listi}

\begin{figure}[h]
\centering
\includegraphics[width=0.9\textwidth]{resource/img/live-migration}
\caption{Illustration d'un \emph{live migration} (migration à chaud)}
\label{livemigration}
\end{figure}

\subsection{Recherche de solutions}
\paragraph*{}
Un travail en amont réalisé par mon tuteur de stage a permis de déterminer une solution technique pour répondre aux besoins d'AlterWay.\\
Cette solution utilise comme logiciels l'hyperviseur de virtualisation \textbf{Xen}\index{Xen} et le gestionnaire de Cloud \textbf{OpenNebula} et des
serveurs de stockage \textbf{NetApp}\footnote{NetApp\index{NetApp} est une société fabriquant des serveurs spécialisée dans le stockage reseau de type SAN (voir \ref{netapp})}.


\paragraph*{}
Les deux logiciels se rapprochant le plus de nos objectifs étaient:
\begin{description}
	\item[OpenStack] \index{OpenStack} est un logiciel \emph{open source} créée par Rackspace et la NASA. Plus de 120 compagnies ont rejoint le projet dont Citrix System, Dell, AMD, Intel,
		Canonical, SUSE Linux, HP et Cisco.\\
		C'est le projet qui évolue probablement le plus vite et qui est le plus complet sur le plan des fonctionnalités.
	\item[OpenNebula] \index{OpenNebula} est un autre logiciel \emph{open source} principalement financé par RESERVOIR
	\footnote{Une organisation européenne de financement de projet \emph{open source} dans le domaine du Cloud Computing} et auquel contribuent d'autres organisations
	comme l'INRIA, le CNRS et d'autres organisations et universités européennes.\\
	Ce logiciel est moins avancé. Cependant, les fonctionnalités qui nous intéressent et qui sont absentes ne le sont pas non pluefficacements dans OpenStack.
\end{description}


\paragraph*{}
\label{cloudissues}
Lors de la recherche du logiciel de gestion de cloud, aucune solution ne correspondait entièrement à nos attentes pour deux raisons:
\begin{listi}
	\item L'augmentation de puissance d'une application client est mise en oeuvre par la multiplication d'instance de VM de ce client.
		Il faut donc que l'environnement application tournant sur la VM soit conçu pour pouvoir tourner efficacement sur
		plusieurs machines.\\
		Malheureusement, la grande majorité des applications des clients d'Alter Way n'a pas été pensée et créée pour tirer parti de la
		puissance de plusieurs machines.\\
		Pour ces clients, lors d'une demande d'augmentation de puissance, il est seulement possible d'augmenter directement à chaud
		la puissance allouée à la VM.

	\item La gestion indépendante du stockage des VMs. Dans ces solutions, les images disque\footnote{une image disque est un gros fichier contenant les données
	du disque dur virtuel apparaissant à la VM} sont typiquement stockées directement sur l'hyperviseur et leur manipulation est souvent très restreinte.
\end{listi}

\paragraph*{}
Ces lacunes viennent du fait que ces plateformes de cloud IaaS sont principalement censées être utilisées avec des applications pensées pour fonctionner sur plusieurs VMs. \\
De plus, les images disques des VMs ne sont pas considérées comme importantes car elles ne sont pas censées contenir des données critiques et doivent pouvoir être facilement
recrées afin de déployer rapidement de nouvelles VMs. Encore une fois, ce cas d'utilisation ne correspond pas à la plupart de nos clients.

\paragraph*{}
Aucune solution existante ne convenant parfaitement à notre besoin, il a été décidé de choisir la solution la plus facile à adapter.
En effet, ces logiciels étant \emph{open source}, il est tout à fait possible de demander à un développeur d'ajouter les fonctionnalités manquantes.

\paragraph*{}
Une fois les fonctionnalités développées, chaque logiciel étant continuellement mise-à-jour, il faut soit:
\begin{listi}
	\item garder un développeur qui s'occupe d'adapter continuellement ces fonctionnalités aux mises-à-jour du logiciel
	\item soit envoyer les patches\footnote{fichier texte contenant les différences de code source entre le logiciel original et sa version modifiée}
		au projet original (appelé couramment \emph{upstream} dans ce contexte)
\end{listi}

Il a été choisi d'envoyer ces fonctionnalités au projet \emph{upstream} pour des raisons de simplicité et aussi pour contribuer au monde de
l'\emph{open source} qui fournit la quasi totalité des logiciels qu'Alter Way Hosting utilise.

\paragraph*{}
C'est pour ces raisons qu'OpenNebula a été choisi car son design plus modulaire et sa plus faible complexité (comparé à OpenStack) le rend
plus apte à être modifié.

\section{Sujet initial}
\paragraph*{}
Mon sujet de stage était d'étudier le logiciel OpenNebula et de le modifier afin d'ajouter le \emph{scale in}\index{Scale In}\footnote{Le \emph{scale in} consiste à
modifier la puissance disponible à un client en redimentionnant sa VM. Par opposition le \emph{scale out} répond au même besoin en multipliant le nombre de VM.
Pour faire du \emph{scale out}\index{Scale out} il faut au préalable un environnement logiciel adapté.} et une gestion plus souple des images disque.

Voici la liste des objectifs:

\begin{enumerate}
	\item Étudier l'environnement technologique du stage
		\begin{enumerate}
		\item OpenNebula
		\item Xen
		\item l'iSCSI\index{iSCSI}: protocole réseau pour attacher de manière transparente des disques distants à une machine physique ou une VM
			au travers d'un réseau Ethernet standard.
		\item l'interface NetApp
		\end{enumerate}
	\item Ajouter à OpenNebula le support hétérogène de multiples serveurs de stockage.
		\subitem Tester la solution
	\item Ajouter à OpenNebula la gestion du \emph{hotplug}\index{HotPlug}\footnote{en français: Ajout à chaud, pendant que la machine est en cours de fonctionnement}
		de VCPUs et de mémoire vive.
		\subitem Tester la solution
	\item Envoyer les modifications à la communauté OpenNebula pour que les modifications soient accessibles à tous et maintenues par les développeurs du projet.
	\item Adapter l'interface web d'OpenNebula aux nouvelles fonctionnalités.
	\item Interfacer le logiciel de monitoring de l'entreprise pour surveiller l'état du \emph{cluster}\index{Cluster}\footnote{Désigne un ensemble d'objets. Dans le contexte
	du cloud computing, l'ensemble des serveurs du Data Center}.
	\item Déployer la version modifiée d'OpenNebula et tous les autres logiciels nécessaires (GNU/Debian, Xen ...) sur le cluster d'Alter Way.
	\item Documenter comment utiliser ce Cloud à l'intention de l'équipe d'Alter Way Hosting
\end{enumerate}

